---
phase: 03-google-sheet-dashboard
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Dashboard displays in browser with correct formatting"
    - "Green cells visible for PAIRED/WIN results"
    - "Emoji indicators render correctly"
    - "Summary row shows totals"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete dashboard implementation with a manual test.

Purpose: Confirm all Phase 3 requirements are met before marking complete.
Output: Verified dashboard with all formatting, colors, and summary working.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-google-sheet-dashboard/03-01-SUMMARY.md
@.planning/phases/03-google-sheet-dashboard/03-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dashboard test script</name>
  <files>test_dashboard.py</files>
  <action>
Create `test_dashboard.py` to test the dashboard with sample data:

```python
#!/usr/bin/env python3
"""
Test script for Google Sheets dashboard.
Creates sample window data and logs to dashboard.
"""
from sheets_dashboard import init_dashboard, log_dashboard_row

def test_dashboard():
    print("Testing Google Sheets Dashboard...")

    dashboard = init_dashboard()
    if not dashboard or not dashboard.enabled:
        print("Dashboard not enabled. Check:")
        print("  1. GOOGLE_SHEETS_CREDENTIALS_FILE env var")
        print("  2. SHARE_WITH_EMAIL env var (for auto-share)")
        return False

    print("Dashboard connected!")

    # Test 1: ARB PAIRED trade (should be green)
    test_state_1 = {
        'slug': 'btc-updown-15m-1737417600',
        'arb_entry': {'up_shares': 5, 'down_shares': 5},
        'arb_result': 'PAIRED',
        'arb_pnl': 0.05,
        'capture_entry': None,
        'capture_result': None,
        'capture_pnl': 0,
    }
    print("Logging test 1: ARB PAIRED (+$0.05)...")
    log_dashboard_row(test_state_1)

    # Test 2: ARB BAIL trade (should be red)
    test_state_2 = {
        'slug': 'btc-updown-15m-1737418500',
        'arb_entry': {'up_shares': 5, 'down_shares': 0},
        'arb_result': 'BAIL',
        'arb_pnl': -0.15,
        'capture_entry': None,
        'capture_result': None,
        'capture_pnl': 0,
    }
    print("Logging test 2: ARB BAIL (-$0.15)...")
    log_dashboard_row(test_state_2)

    # Test 3: 99c capture WIN (should be green)
    test_state_3 = {
        'slug': 'btc-updown-15m-1737419400',
        'arb_entry': None,
        'arb_result': None,
        'arb_pnl': 0,
        'capture_entry': {'side': 'UP', 'shares': 5},
        'capture_result': 'WIN',
        'capture_pnl': 0.05,
    }
    print("Logging test 3: 99c WIN (+$0.05)...")
    log_dashboard_row(test_state_3)

    # Test 4: 99c capture LOSS (should be red)
    test_state_4 = {
        'slug': 'btc-updown-15m-1737420300',
        'arb_entry': None,
        'arb_result': None,
        'arb_pnl': 0,
        'capture_entry': {'side': 'DOWN', 'shares': 5},
        'capture_result': 'LOSS',
        'capture_pnl': -4.95,
    }
    print("Logging test 4: 99c LOSS (-$4.95)...")
    log_dashboard_row(test_state_4)

    print()
    print("Test complete! Check your Google Sheet:")
    print("  - 4 data rows should appear")
    print("  - PAIRED/WIN cells should be GREEN")
    print("  - BAIL/LOSS cells should be RED")
    print("  - Emoji indicators: ✓ for wins, ✗ for losses")
    print("  - Summary row should show totals and win rates")

    return True

if __name__ == "__main__":
    test_dashboard()
```
  </action>
  <verify>
```bash
python3 -c "import test_dashboard; print('Test script created')"
```
  </verify>
  <done>test_dashboard.py exists with sample data for all trade types</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Google Sheets dashboard with colors, emojis, and summary row</what-built>
  <how-to-verify>
1. Set required environment variables:
   ```bash
   export GOOGLE_SHEETS_CREDENTIALS_FILE=~/.google_sheets_credentials.json
   export SHARE_WITH_EMAIL=your.email@example.com
   ```

2. Run the test script:
   ```bash
   python3 test_dashboard.py
   ```

3. Open the Google Sheet (check email for share notification or look in Google Drive)

4. Verify:
   - [ ] Headers in row 1 (Window, Time, ARB Entry, ARB Result, ARB P/L, 99c Entry, 99c Result, 99c P/L, Total P/L)
   - [ ] Summary row in row 2 with totals (2/2 ARB win rate, 1/2 99c win rate)
   - [ ] 4 test data rows (rows 3-6)
   - [ ] Green background on PAIRED result cell and positive P/L cells
   - [ ] Red background on BAIL/LOSS result cells and negative P/L cells
   - [ ] Emoji ✓ appears for PAIRED and WIN
   - [ ] Emoji ✗ appears for BAIL and LOSS
   - [ ] Summary P/L totals are correct ($-4.90 total based on test data)
  </how-to-verify>
  <resume-signal>Type "approved" if all verification items pass, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
User confirms dashboard displays correctly in browser with:
- Color-coded cells (green/red)
- Emoji indicators
- Summary row with totals
</verification>

<success_criteria>
- User approves dashboard appearance
- All SHEET-01 through SHEET-05 requirements verified complete
- Phase 3 can be marked complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-google-sheet-dashboard/03-03-SUMMARY.md`
</output>
